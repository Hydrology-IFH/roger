# Tutorial for Monte-Carlo simulations using the SVAT-model
SVAT indicates that only vertical processes are considered.

- `input`: Contains input data
- `output`: Contains output data
- `figures`: Contains figures
- `config.yml`: File to set parameters and output variables
- `param_bounds.yml`: Contains parameter boundaries to generate model paramters for Monte-Carlo simulations
- `write_parameters.py`: Generates model parameters and writes model parameter file
- `svat.py`: SVAT-model setup
- `merge_output.py`: Merges output into a single NetCDF file
- `netcdf_to_csv.py`: Writes output to csv files
- `make_figures_and_tables.py`: Produces figures and tables

# Custom land cover
The custom land cover class is implemented by `lu_id` = 60. The seasonal variation of the interception storage capacity (`S_int_ground_tot` in mm) is implmented as:

| Jan   | Feb   | Mar   | Apr   | May   | Jun   | Jul   | Aug   | Sep   | Oct   | Nov   | Dec   | 
| ------| ------| ------| ------| ------| ------| ------| ------| ------| ------| ------| ------|
| 1     | 1     | 1     | 0.8   | 0.6   | 0.4   | 0.2   | 0.4   | 0.6   | 0.7   | 0.8   | 1     |

`c_int` scales the interception storage capacity. Similarly, `c_root` scales the default root depth of `lu_id` = 60 is 400 mm.
`S_int_ground_tot_sum`= 8.5 mm (i.e. sum of rows in Table above)

# Date requirements

The following information is required to run the model. 

## Meteorological input data
The required meteorological input data is loaded from the input folder. The input folder should contain a tab-delimited text file
for precipitation (`PREC.txt`; 10 minutes time steps), air temperature (`TA.txt`; daily time steps) and potential evapotranspiration (`PET.txt`; daily time steps).

Format of `PREC.txt` (PREC in mm/10 minutes):
| YYYY  | MM    | DD    | hh    | mm    | PREC  |
| ------| ------| ------| ------| ------| ------|
| 2023  | 1     | 1     | 0     | 0     | 0     |
| 2023  | 1     | 1     | 0     | 10    | 0.3   |        
| 2023  | 1     | 1     | 0     | 20    | 1.0   |
| 2023  | 1     | 1     | 0     | 30    | 0.5   |        
| 2023  | 1     | 1     | 0     | 40    | 0.4   |
| 2023  | 1     | 1     | 0     | 50    | 0.7   |        
| 2023  | 1     | 1     | 1     | 0     | 0.6   |
| ...   | ...   | ...   | ...   | ...   | ...   |

Format of`TA.txt` (TA in degC):
| YYYY  | MM    | DD    | hh    | mm    | TA    |
| ------| ------| ------| ------| ------| ------|
| 2023  | 1     | 1     | 0     | 0     | 2     |
| 2023  | 1     | 1     | 0     | 0     | 3     |        
| ...   | ...   | ...   | ...   | ...   | ...   |

Format of `PET.txt` (PET in mm/day):
| YYYY  | MM    | DD    | hh    | mm    | PET   |
| ------| ------| ------| ------| ------| ------|
| 2023  | 1     | 1     | 0     | 0     | 2     |
| 2023  | 1     | 1     | 0     | 0     | 2.1   |        
| ...   | ...   | ...   | ...   | ...   | ...   |


where YYYY is the year, MM is the month, DD is the day, hh is the hour and mm is the minute.

## Model parameters
The model parameters (`parameters.csv`) are loaded from the same directory as `svat.py`.

Model parameters for Monte-Carlo simulations can be generated by running the following script:
```
python write_parameters.py
```

Format of `parameters.csv` for which each row contains the parameters for a grid cell:
| lu_id | z_soil   | dmpv  | lmpv  | theta_pwp | theta_ufc | theta_ac | ks  | kf   | z_root| c_root | c_int | S_int_ground_tot_sum |
| ------| ---------| ------| ------| ----------| ----------| ---------| ----| -----| ------| -------| ------| ------|
| 8     | 1000     | 25    | 200   | 0.2       | 0.11      | 0.09     | 5   | 2500 | 320   | 0.8    | 0.8   | 6.8   |  
| 8     | 1000     | 30    | 300   | 0.18      | 0.1       | 0.08     | 6   | 2500 | 480   | 1.2    | 1.2   | 10.2  |
| ...   | ...      | ...   | ...   | ...       | ...       | ...      | ... | ...  | ...   | ...    | ...   | ...   |

where *lu_id* is the land cover, *z_soil* is the soil depth (mm), *dmpv* is the density of vertical macropores (1/$m^2$), *lmpv* is the length of vertical macropores (mm), *theta_pwp* is soil water content of the permanent wilting point (-), *theta_ufc* is soil water content of the usable field capacity (-), *theta_ac* is soil water content of the air capacity (-), *ks* is the saturated hydraulic conductivity (mm/hour), *kf* is the hydraulic conductivity of the bedrock (mm/hour), *z_root* is the scaled root depth (mm; $400 mm \cdot c_{root}$), *c_root* is the scale parameter for the root depth (-), *c_int* is the scale parameter for the interception storage capacity (-) and *S_int_ground_tot_sum* is the scaled sum of the interception storage capacity (mm).

## Model settings
Name of model experiment and spatial discretization are defined in `config.yml`.

## Model output
The variables written to the output files are defined in `config.yml`. Available variables
are listed [here](https://roger.readthedocs.io/en/latest/reference/variables.html#available-variables). Generally, storage variables
should be defined in `OUTPUT_COLLECT` and flux variables in `OUTPUT_RATE`.

# Workflow

The following workflow briefly describes the model application:

1. Prepare the meteorological input data (see Meteorological input data).

2. Generate the model paramaters for the Monte-Carlo simulations:
```
python write_parameters.py
```

3. If required data is ready, the following script runs the simulations:

```
python svat.py
```

4. After calculation is done, the simulation results can be merged in a single NetCDF-file:
```
python merge_output.py
```

5. (Optional) The following script converts the model output from NetCDF to csv.
```
python netcdf_to_csv.py
```

6. Figures and tables can be produced with the following script:
```
python make_figures_and_tables.py
```