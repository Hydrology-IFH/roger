<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>roger.tools.evaluation &mdash; RoGeR 0.0.1+488.ge1b7b1c.dirty documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> RoGeR
          </a>
              <div class="version">
                0.0.1+488.ge1b7b1c.dirty
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Start here</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/introduction.html">A short introduction to Roger</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/get-started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/advanced-installation.html">Advanced installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/analysis.html">Analysis of simulations with Roger</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/cluster.html">Running Roger on a cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/dev.html">Making changes in Roger</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Model equations</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../equations/equations.html">Model equations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../equations/hydrologic_cycle.html">Hydrologic cycle</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../equations/solute_transport.html">Solute transport</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/model-gallery.html">Model gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/settings.html">Constant model parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/variables.html">Model variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/diagnostics.html">Diagnostics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/cli.html">Command line tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/public-api.html">Python API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">More Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../more/benchmarks.html">Benchmarks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../more/howtocite.html">How to cite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../more/publications.html">Publications involving Roger</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/Hydrology-IFH/roger">Visit us on GitHub</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">RoGeR</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      <li>roger.tools.evaluation</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for roger.tools.evaluation</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">onp</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">matplotlib.dates</span> <span class="k">as</span> <span class="nn">mdates</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;agg&quot;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>  <span class="c1"># noqa: E402</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s2">&quot;ticks&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">filter_headers</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">substr</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">str</span> <span class="k">for</span> <span class="nb">str</span> <span class="ow">in</span> <span class="n">string</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^\d]+|^&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="ow">in</span> <span class="n">substr</span><span class="p">]</span>


<div class="viewcode-block" id="join_obs_on_sim"><a class="viewcode-back" href="../../../reference/api/tools.html#roger.tools.evaluation.join_obs_on_sim">[docs]</a><span class="k">def</span> <span class="nf">join_obs_on_sim</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">sim_vals</span><span class="p">,</span> <span class="n">df_obs</span><span class="p">,</span> <span class="n">rm_na</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Join observed values on simulated values.</span>

<span class="sd">    Args</span>
<span class="sd">    ----------</span>
<span class="sd">    idx : pd.DatetimeIndex</span>
<span class="sd">        time index</span>

<span class="sd">    sim_vals : onp.ndarray</span>
<span class="sd">        simulated values</span>

<span class="sd">    df_obs : pd.DataFrame</span>
<span class="sd">        observed values</span>

<span class="sd">    rm_na : boolean, optional</span>
<span class="sd">        whether NaNs are removed. default is False.</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pd.DataFrame</span>
<span class="sd">        DataFrame containing simulated and observed values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># dataframe with simulated values</span>
    <span class="k">if</span> <span class="n">sim_vals</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">df_sim</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">sim_vals</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sim&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sim_header</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;sim</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sim_vals</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])]</span>
        <span class="n">df_sim</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">sim_vals</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">sim_header</span><span class="p">)</span>

    <span class="c1"># dataframe with observed values</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">idx</span><span class="p">)</span>
    <span class="n">df_obs</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df_obs</span><span class="p">)</span>
    <span class="n">df_obs</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;obs&#39;</span><span class="p">]</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">df_sim</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">df_obs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">rm_na</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">df</span></div>


<div class="viewcode-block" id="plot_sim"><a class="viewcode-back" href="../../../reference/api/tools.html#roger.tools.evaluation.plot_sim">[docs]</a><span class="k">def</span> <span class="nf">plot_sim</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">y_lab</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ls_obs</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="n">x_lab</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot simulated values.</span>

<span class="sd">    Args</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pd.DataFrame</span>
<span class="sd">        Dataframe with simulated and observed values</span>

<span class="sd">    y_lab : str</span>
<span class="sd">        label of y-axis</span>

<span class="sd">    ls_obs : str, optional</span>
<span class="sd">        linestyle of observations</span>

<span class="sd">    x_lab : str, optional</span>
<span class="sd">        label of x-axis</span>

<span class="sd">    ylim : tuple, optional</span>
<span class="sd">        y-axis limits</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    fig : Figure</span>
<span class="sd">        Plot for observed and simulated values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># plot observed and simulated values</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">ylim</span><span class="p">:</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">y_lab</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_lab</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="plot_sim_cum"><a class="viewcode-back" href="../../../reference/api/tools.html#roger.tools.evaluation.plot_sim_cum">[docs]</a><span class="k">def</span> <span class="nf">plot_sim_cum</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">y_lab</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ls_obs</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="n">x_lab</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot simulated values.</span>

<span class="sd">    Args</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pd.DataFrame</span>
<span class="sd">        Dataframe with simulated and observed values</span>

<span class="sd">    y_lab : str</span>
<span class="sd">        label of y-axis</span>

<span class="sd">    ls_obs : str, optional</span>
<span class="sd">        linestyle of observations</span>

<span class="sd">    x_lab : str, optional</span>
<span class="sd">        label of x-axis</span>

<span class="sd">    ylim : tuple, optional</span>
<span class="sd">        y-axis limits</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    fig : Figure</span>
<span class="sd">        Plot for observed and simulated values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># plot observed and simulated values</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">ylim</span><span class="p">:</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">y_lab</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_lab</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="plot_obs_sim"><a class="viewcode-back" href="../../../reference/api/tools.html#roger.tools.evaluation.plot_obs_sim">[docs]</a><span class="k">def</span> <span class="nf">plot_obs_sim</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">y_lab</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ls_obs</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="n">x_lab</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot observed and simulated values.</span>

<span class="sd">    Args</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pd.DataFrame</span>
<span class="sd">        Dataframe with simulated and observed values</span>

<span class="sd">    y_lab : str</span>
<span class="sd">        label of y-axis</span>

<span class="sd">    fmt_x : str, optional</span>
<span class="sd">        Format of x-axis. Default is numerical (&#39;num&#39;). Alternatively, date</span>
<span class="sd">        format can be used (&#39;date&#39;).</span>

<span class="sd">    ls_obs : str, optional</span>
<span class="sd">        linestyle of observations</span>

<span class="sd">    x_lab : str, optional</span>
<span class="sd">        label of x-axis</span>

<span class="sd">    ylim : tuple, optional</span>
<span class="sd">        y-axis limits</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    fig : Figure</span>
<span class="sd">        Plot for observed and simulated values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># plot observed and simulated values</span>
    <span class="n">sim_headers</span> <span class="o">=</span> <span class="n">filter_headers</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;sim&#39;</span><span class="p">])</span>
    <span class="n">bench_headers</span> <span class="o">=</span> <span class="n">filter_headers</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;bench&#39;</span><span class="p">])</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">sim_header</span> <span class="ow">in</span> <span class="n">sim_headers</span><span class="p">:</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">sim_header</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">bench_headers</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">bench_header</span> <span class="ow">in</span> <span class="n">bench_headers</span><span class="p">:</span>
            <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">bench_header</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ls_obs</span> <span class="o">==</span> <span class="s1">&#39;line&#39;</span><span class="p">):</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;obs&#39;</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;obs&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">ylim</span><span class="p">:</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">y_lab</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_lab</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="plot_obs_sim_year"><a class="viewcode-back" href="../../../reference/api/tools.html#roger.tools.evaluation.plot_obs_sim_year">[docs]</a><span class="k">def</span> <span class="nf">plot_obs_sim_year</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">y_lab</span><span class="p">,</span> <span class="n">start_month_hyd_year</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ls_obs</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="n">x_lab</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot observed and simulated values.</span>

<span class="sd">    Args</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pd.DataFrame</span>
<span class="sd">        Dataframe with simulated and observed values</span>

<span class="sd">    y_lab : str</span>
<span class="sd">        label of y-axis</span>

<span class="sd">    start_month_hyd_year : int, optional</span>
<span class="sd">        starting month of hydrologic year</span>

<span class="sd">    ls_obs : str, optional</span>
<span class="sd">        linestyle of observations</span>

<span class="sd">    x_lab : str, optional</span>
<span class="sd">        label of x-axis</span>

<span class="sd">    ylim : tuple, optional</span>
<span class="sd">        y-axis limits</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    figs : list</span>
<span class="sd">        list with figures</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">figs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">sim_headers</span> <span class="o">=</span> <span class="n">filter_headers</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;sim&#39;</span><span class="p">])</span>
    <span class="n">bench_headers</span> <span class="o">=</span> <span class="n">filter_headers</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;bench&#39;</span><span class="p">])</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">assign_hyd_year</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">start_month_hyd_year</span><span class="o">=</span><span class="n">start_month_hyd_year</span><span class="p">)</span>
    <span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">hyd_year</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">years</span><span class="p">:</span>
        <span class="n">df_year</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">hyd_year</span> <span class="o">==</span> <span class="n">year</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">df_year</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_year</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># plot observed and simulated values</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">sim_header</span> <span class="ow">in</span> <span class="n">sim_headers</span><span class="p">:</span>
            <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">sim_header</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bench_headers</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">bench_header</span> <span class="ow">in</span> <span class="n">bench_headers</span><span class="p">:</span>
                <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">bench_header</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ls_obs</span> <span class="o">==</span> <span class="s1">&#39;line&#39;</span><span class="p">):</span>
            <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_year</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df_year</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;obs&#39;</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_year</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df_year</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="s1">&#39;obs&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="n">df_year</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">df_year</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">ylim</span><span class="p">:</span>
            <span class="n">axs</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">y_lab</span><span class="p">)</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">))</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_year</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">120</span><span class="p">):</span>
            <span class="n">axs</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%m&#39;</span><span class="p">))</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_year</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">120</span><span class="p">):</span>
            <span class="n">axs</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">-%m&#39;</span><span class="p">))</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">figs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">figs</span></div>


<div class="viewcode-block" id="plot_obs_sim_cum"><a class="viewcode-back" href="../../../reference/api/tools.html#roger.tools.evaluation.plot_obs_sim_cum">[docs]</a><span class="k">def</span> <span class="nf">plot_obs_sim_cum</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">y_lab</span><span class="p">,</span> <span class="n">x_lab</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot cumulated observed and simulated values.</span>

<span class="sd">    Args</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pd.DataFrame</span>
<span class="sd">        Dataframe with simulated and observed values</span>

<span class="sd">    y_lab : str</span>
<span class="sd">        label of y-axis</span>

<span class="sd">    x_lab : str, optional</span>
<span class="sd">        label of x-axis</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    fig : Figure</span>
<span class="sd">        Plot for observed and simulated values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># plot observed and simulated values</span>
    <span class="n">sim_headers</span> <span class="o">=</span> <span class="n">filter_headers</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;sim&#39;</span><span class="p">])</span>
    <span class="n">bench_headers</span> <span class="o">=</span> <span class="n">filter_headers</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;bench&#39;</span><span class="p">])</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">sim_header</span> <span class="ow">in</span> <span class="n">sim_headers</span><span class="p">:</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">sim_header</span><span class="p">]</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">bench_headers</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">bench_header</span> <span class="ow">in</span> <span class="n">bench_headers</span><span class="p">:</span>
            <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">bench_header</span><span class="p">]</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;obs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(),</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">y_lab</span><span class="p">)</span>
    <span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_lab</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="plot_obs_sim_cum_year"><a class="viewcode-back" href="../../../reference/api/tools.html#roger.tools.evaluation.plot_obs_sim_cum_year">[docs]</a><span class="k">def</span> <span class="nf">plot_obs_sim_cum_year</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">y_lab</span><span class="p">,</span> <span class="n">start_month_hyd_year</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">x_lab</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot cumulated observed and simulated values for each hydrologic year.</span>

<span class="sd">    Args</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pd.DataFrame</span>
<span class="sd">        Dataframe with simulated and observed values</span>

<span class="sd">    y_lab : str</span>
<span class="sd">        label of y-axis</span>

<span class="sd">    start_month_hyd_year : int, optional</span>
<span class="sd">        starting month of hydrologic year</span>

<span class="sd">    x_lab : str, optional</span>
<span class="sd">        label of x-axis</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    figs : list</span>
<span class="sd">        list with figures</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">figs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">sim_headers</span> <span class="o">=</span> <span class="n">filter_headers</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;sim&#39;</span><span class="p">])</span>
    <span class="n">bench_headers</span> <span class="o">=</span> <span class="n">filter_headers</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;bench&#39;</span><span class="p">])</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">assign_hyd_year</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">start_month_hyd_year</span><span class="o">=</span><span class="n">start_month_hyd_year</span><span class="p">)</span>
    <span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">hyd_year</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">years</span><span class="p">:</span>
        <span class="n">df_year</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">hyd_year</span> <span class="o">==</span> <span class="n">year</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">df_year</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_year</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># plot observed and simulated values</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">sim_header</span> <span class="ow">in</span> <span class="n">sim_headers</span><span class="p">:</span>
            <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_year</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df_year</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">sim_header</span><span class="p">]</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bench_headers</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">bench_header</span> <span class="ow">in</span> <span class="n">bench_headers</span><span class="p">:</span>
                <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">bench_header</span><span class="p">]</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_year</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df_year</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;obs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="n">df_year</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">df_year</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">y_lab</span><span class="p">)</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">))</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_year</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">120</span><span class="p">):</span>
            <span class="n">axs</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%m&#39;</span><span class="p">))</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_year</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">120</span><span class="p">):</span>
            <span class="n">axs</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">-%m&#39;</span><span class="p">))</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">figs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">figs</span></div>


<div class="viewcode-block" id="plot_obs_sim_cum_year_facet"><a class="viewcode-back" href="../../../reference/api/tools.html#roger.tools.evaluation.plot_obs_sim_cum_year_facet">[docs]</a><span class="k">def</span> <span class="nf">plot_obs_sim_cum_year_facet</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">y_lab</span><span class="p">,</span> <span class="n">start_month_hyd_year</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">x_lab</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot cumulated observed and simulated values for each hydrologic year.</span>

<span class="sd">    Args</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pd.DataFrame</span>
<span class="sd">        Dataframe with simulated and observed values</span>

<span class="sd">    y_lab : str</span>
<span class="sd">        label of y-axis</span>

<span class="sd">    start_month_hyd_year : int, optional</span>
<span class="sd">        starting month of hydrologic year</span>

<span class="sd">    x_lab : str, optional</span>
<span class="sd">        label of x-axis</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    fig : Figure</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>
    <span class="n">sim_headers</span> <span class="o">=</span> <span class="n">filter_headers</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;sim&#39;</span><span class="p">])</span>
    <span class="n">bench_headers</span> <span class="o">=</span> <span class="n">filter_headers</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;bench&#39;</span><span class="p">])</span>
    <span class="n">df_cs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">assign_hyd_year</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">start_month_hyd_year</span><span class="o">=</span><span class="n">start_month_hyd_year</span><span class="p">)</span>
    <span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">hyd_year</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">years</span><span class="p">:</span>
        <span class="n">df_cs</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">hyd_year</span> <span class="o">==</span> <span class="n">year</span><span class="p">),</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">hyd_year</span> <span class="o">==</span> <span class="n">year</span><span class="p">),</span> <span class="n">headers</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">df_cs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_cs</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># DataFrame from wide to long format</span>
    <span class="n">ll_dfs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">palette</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sim_header</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sim_headers</span><span class="p">):</span>
        <span class="n">df_sim</span> <span class="o">=</span> <span class="n">df_cs</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">sim_header</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
        <span class="n">df_sim</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sim_obs&#39;</span><span class="p">]</span>
        <span class="n">df_sim</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;sim</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">ll_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_sim</span><span class="p">)</span>
        <span class="n">palette</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">bench_headers</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">bench_header</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bench_headers</span><span class="p">):</span>
            <span class="n">df_bench</span> <span class="o">=</span> <span class="n">df_cs</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">bench_header</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
            <span class="n">df_bench</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sim_obs&#39;</span><span class="p">]</span>
            <span class="n">df_bench</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;bench</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">ll_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_bench</span><span class="p">)</span>
            <span class="n">palette</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;grey&#39;</span><span class="p">)</span>
    <span class="n">df_obs</span> <span class="o">=</span> <span class="n">df_cs</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;obs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
    <span class="n">df_obs</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sim_obs&#39;</span><span class="p">]</span>
    <span class="n">df_obs</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;obs&#39;</span>
    <span class="n">ll_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_obs</span><span class="p">)</span>
    <span class="n">palette</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
    <span class="n">df_sim_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">ll_dfs</span><span class="p">)</span>
    <span class="n">df_sim_obs_long</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">df_sim_obs</span><span class="p">,</span> <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span> <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sim_obs&#39;</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">df_sim_obs_long</span> <span class="o">=</span> <span class="n">assign_hyd_year</span><span class="p">(</span><span class="n">df_sim_obs_long</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">start_month_hyd_year</span><span class="o">=</span><span class="n">start_month_hyd_year</span><span class="p">)</span>
    <span class="n">df_sim_obs_long</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_sim_obs_long</span><span class="o">.</span><span class="n">index</span>
    <span class="n">df_sim_obs_long</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_sim_obs_long</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">df_sim_obs_long</span> <span class="o">=</span> <span class="n">df_sim_obs_long</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;variable&#39;</span><span class="p">])</span>
    <span class="n">df_sim_obs_long</span> <span class="o">=</span> <span class="n">df_sim_obs_long</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;type&quot;</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                                    <span class="s2">&quot;value&quot;</span> <span class="p">:</span> <span class="n">onp</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
                                                    <span class="s2">&quot;hyd_year&quot;</span> <span class="p">:</span> <span class="n">onp</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span>
                                                    <span class="s2">&quot;time&quot;</span> <span class="p">:</span> <span class="n">onp</span><span class="o">.</span><span class="n">datetime64</span><span class="p">})</span>
    <span class="n">df_sim_obs_long</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_sim_obs_long</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
    <span class="c1"># Plot the lines on facets</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">relplot</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">df_sim_obs_long</span><span class="p">,</span>
        <span class="n">x</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
        <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s2">&quot;hyd_year&quot;</span><span class="p">,</span>
        <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">palette</span><span class="p">,</span>
        <span class="n">facet_kws</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
        <span class="n">height</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mf">.7</span><span class="p">,</span> <span class="n">col_wrap</span><span class="o">=</span><span class="mi">4</span>
    <span class="p">)</span>
    <span class="n">g</span><span class="o">.</span><span class="n">set_ylabels</span><span class="p">(</span><span class="n">y_lab</span><span class="p">)</span>
    <span class="n">g</span><span class="o">.</span><span class="n">set_xlabels</span><span class="p">(</span><span class="n">x_lab</span><span class="p">)</span>
    <span class="n">g</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">axs</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">():</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">-%m&#39;</span><span class="p">))</span>
    <span class="n">g</span><span class="o">.</span><span class="n">set_titles</span><span class="p">(</span><span class="n">template</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{col_name}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">g</span><span class="o">.</span><span class="n">_legend</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
    <span class="n">g</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">fig</span>

    <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="plot_sim_cum_year_facet"><a class="viewcode-back" href="../../../reference/api/tools.html#roger.tools.evaluation.plot_sim_cum_year_facet">[docs]</a><span class="k">def</span> <span class="nf">plot_sim_cum_year_facet</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">y_lab</span><span class="p">,</span> <span class="n">start_month_hyd_year</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">x_lab</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot cumulated observed and simulated values for each hydrologic year.</span>

<span class="sd">    Args</span>
<span class="sd">    ----------</span>
<span class="sd">    df : pd.DataFrame</span>
<span class="sd">        Dataframe with simulated values</span>

<span class="sd">    y_lab : str</span>
<span class="sd">        label of y-axis</span>

<span class="sd">    start_month_hyd_year : int, optional</span>
<span class="sd">        starting month of hydrologic year</span>

<span class="sd">    x_lab : str, optional</span>
<span class="sd">        label of x-axis</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    fig : Figure</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>
    <span class="n">sim_headers</span> <span class="o">=</span> <span class="n">filter_headers</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;sim&#39;</span><span class="p">])</span>
    <span class="n">bench_headers</span> <span class="o">=</span> <span class="n">filter_headers</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;bench&#39;</span><span class="p">])</span>
    <span class="n">df_cs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">assign_hyd_year</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">start_month_hyd_year</span><span class="o">=</span><span class="n">start_month_hyd_year</span><span class="p">)</span>
    <span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">hyd_year</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">years</span><span class="p">:</span>
        <span class="n">df_cs</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">hyd_year</span> <span class="o">==</span> <span class="n">year</span><span class="p">),</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">hyd_year</span> <span class="o">==</span> <span class="n">year</span><span class="p">),</span> <span class="n">headers</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">df_cs</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_cs</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># DataFrame from wide to long format</span>
    <span class="n">ll_dfs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">palette</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sim_header</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sim_headers</span><span class="p">):</span>
        <span class="n">df_sim</span> <span class="o">=</span> <span class="n">df_cs</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">sim_header</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
        <span class="n">df_sim</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sim_obs&#39;</span><span class="p">]</span>
        <span class="n">df_sim</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;sim</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">ll_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_sim</span><span class="p">)</span>
        <span class="n">palette</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">bench_headers</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">bench_header</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bench_headers</span><span class="p">):</span>
            <span class="n">df_bench</span> <span class="o">=</span> <span class="n">df_cs</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">bench_header</span><span class="p">]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
            <span class="n">df_bench</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sim_obs&#39;</span><span class="p">]</span>
            <span class="n">df_bench</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;bench</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">ll_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_bench</span><span class="p">)</span>
            <span class="n">palette</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;grey&#39;</span><span class="p">)</span>
    <span class="n">df_sim_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">ll_dfs</span><span class="p">)</span>
    <span class="n">df_sim_long</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">df_sim_obs</span><span class="p">,</span> <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span> <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sim_obs&#39;</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">df_sim_long</span> <span class="o">=</span> <span class="n">assign_hyd_year</span><span class="p">(</span><span class="n">df_sim_long</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">start_month_hyd_year</span><span class="o">=</span><span class="n">start_month_hyd_year</span><span class="p">)</span>
    <span class="n">df_sim_long</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_sim_long</span><span class="o">.</span><span class="n">index</span>
    <span class="n">df_sim_long</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_sim_long</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">df_sim_long</span> <span class="o">=</span> <span class="n">df_sim_long</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;variable&#39;</span><span class="p">])</span>
    <span class="n">df_sim_long</span> <span class="o">=</span> <span class="n">df_sim_long</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;type&quot;</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                            <span class="s2">&quot;value&quot;</span> <span class="p">:</span> <span class="n">onp</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
                                            <span class="s2">&quot;hyd_year&quot;</span> <span class="p">:</span> <span class="n">onp</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span>
                                            <span class="s2">&quot;time&quot;</span> <span class="p">:</span> <span class="n">onp</span><span class="o">.</span><span class="n">datetime64</span><span class="p">})</span>
    <span class="n">df_sim_long</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_sim_long</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
    <span class="c1"># Plot the lines on facets</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">relplot</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">df_sim_long</span><span class="p">,</span>
        <span class="n">x</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span>
        <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s2">&quot;hyd_year&quot;</span><span class="p">,</span>
        <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">palette</span><span class="p">,</span>
        <span class="n">facet_kws</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
        <span class="n">height</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mf">.7</span><span class="p">,</span> <span class="n">col_wrap</span><span class="o">=</span><span class="mi">4</span>
    <span class="p">)</span>
    <span class="n">g</span><span class="o">.</span><span class="n">set_ylabels</span><span class="p">(</span><span class="n">y_lab</span><span class="p">)</span>
    <span class="n">g</span><span class="o">.</span><span class="n">set_xlabels</span><span class="p">(</span><span class="n">x_lab</span><span class="p">)</span>
    <span class="n">g</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">axs</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">():</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">-%m&#39;</span><span class="p">))</span>
    <span class="n">g</span><span class="o">.</span><span class="n">set_titles</span><span class="p">(</span><span class="n">template</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{col_name}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">g</span><span class="o">.</span><span class="n">_legend</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
    <span class="n">g</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">fig</span>

    <span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="time_to_num"><a class="viewcode-back" href="../../../reference/api/tools.html#roger.tools.evaluation.time_to_num">[docs]</a><span class="k">def</span> <span class="nf">time_to_num</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="s1">&#39;days&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert DatetimeIndex to numeric range. Conversion is based either on</span>
<span class="sd">    days or hours.</span>

<span class="sd">    Args</span>
<span class="sd">    ----------</span>
<span class="sd">    idx : pd.DatetimeIndex</span>
<span class="sd">        variable time index</span>

<span class="sd">    time : str, optional</span>
<span class="sd">        time unit</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    idx_num : onp.array</span>
<span class="sd">        numerical date range</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">time</span> <span class="o">==</span> <span class="s1">&#39;days&#39;</span><span class="p">:</span>
        <span class="n">idx_num</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;timedelta64[m]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span><span class="o">/</span><span class="mi">1440</span>
        <span class="n">idx_num</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">idx_num</span> <span class="o">=</span> <span class="n">idx_num</span><span class="o">.</span><span class="n">values</span>

    <span class="k">elif</span> <span class="n">time</span> <span class="o">==</span> <span class="s1">&#39;hours&#39;</span><span class="p">:</span>
        <span class="n">idx_num</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;timedelta64[m]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span><span class="o">/</span><span class="mi">60</span>
        <span class="n">idx_num</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">idx_num</span> <span class="o">=</span> <span class="n">idx_num</span><span class="o">.</span><span class="n">values</span>

    <span class="k">return</span> <span class="n">idx_num</span></div>


<div class="viewcode-block" id="assign_hyd_year"><a class="viewcode-back" href="../../../reference/api/tools.html#roger.tools.evaluation.assign_hyd_year">[docs]</a><span class="k">def</span> <span class="nf">assign_hyd_year</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">start_month_hyd_year</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Assign hydrologic year.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : DataFrame</span>
<span class="sd">        contains hydrologic values</span>

<span class="sd">    start_month_hyd_year : int, optional</span>
<span class="sd">        starting month of hydrologic year</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    DataFrame</span>
<span class="sd">        contains hydrologic values and a column with the assigned hydrologic</span>
<span class="sd">        year</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;hyd_year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span> <span class="o">&gt;=</span> <span class="n">start_month_hyd_year</span><span class="p">),</span> <span class="s1">&#39;hyd_year&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">df</span></div>


<div class="viewcode-block" id="assign_seasons"><a class="viewcode-back" href="../../../reference/api/tools.html#roger.tools.evaluation.assign_seasons">[docs]</a><span class="k">def</span> <span class="nf">assign_seasons</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Assign seasons.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    df : DataFrame</span>
<span class="sd">        contains hydrologic values</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    DataFrame</span>
<span class="sd">        contains hydrologic values and a column with the assigned seasons</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">idx_winter</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="mi">12</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">idx_spring</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">idx_summer</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="mi">6</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="mi">7</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="mi">8</span><span class="p">)</span>
    <span class="n">idx_autumn</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="mi">9</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="mi">10</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span> <span class="o">==</span> <span class="mi">11</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx_winter</span><span class="p">,</span> <span class="s1">&#39;seas&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;DJF&#39;</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx_spring</span><span class="p">,</span> <span class="s1">&#39;seas&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;MAM&#39;</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx_summer</span><span class="p">,</span> <span class="s1">&#39;seas&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;JJA&#39;</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx_autumn</span><span class="p">,</span> <span class="s1">&#39;seas&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;SON&#39;</span>

    <span class="k">return</span> <span class="n">df</span></div>


<div class="viewcode-block" id="calc_api"><a class="viewcode-back" href="../../../reference/api/tools.html#roger.tools.evaluation.calc_api">[docs]</a><span class="k">def</span> <span class="nf">calc_api</span><span class="p">(</span><span class="n">prec</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate antecedent precipitation index (API).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    prec : (N,)array_like</span>
<span class="sd">        precipitation values</span>

<span class="sd">    w : int</span>
<span class="sd">        window width</span>

<span class="sd">    k : float</span>
<span class="sd">        decay constant ranges between 0.8 and 0.98</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    api : (N,)array_like</span>
<span class="sd">        antecedent precipitation index</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">api</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">prec</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">api</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">onp</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">k</span><span class="o">**</span><span class="n">onp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">w</span><span class="o">+</span><span class="mi">1</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">w</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">api</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">api</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">prec</span><span class="p">[(</span><span class="n">i</span><span class="o">-</span><span class="n">w</span><span class="p">):</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">weights</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">api</span></div>


<div class="viewcode-block" id="calc_napi"><a class="viewcode-back" href="../../../reference/api/tools.html#roger.tools.evaluation.calc_napi">[docs]</a><span class="k">def</span> <span class="nf">calc_napi</span><span class="p">(</span><span class="n">prec</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate normalized antecedent precipitation index (NAPI).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    prec : (N,)array_like</span>
<span class="sd">        precipitation values</span>

<span class="sd">    w : int</span>
<span class="sd">        window width</span>

<span class="sd">    k : float</span>
<span class="sd">        decay constant ranges between 0.8 and 0.98</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    api : (N,)array_like</span>
<span class="sd">        antecedent precipitation index</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">napi</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">prec</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">napi</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">onp</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">k</span><span class="o">**</span><span class="n">onp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">w</span><span class="o">+</span><span class="mi">1</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">weights_sum</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">k</span><span class="o">**</span><span class="n">onp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">w</span><span class="o">+</span><span class="mi">1</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">w</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">napi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">api</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">prec</span><span class="p">[(</span><span class="n">i</span><span class="o">-</span><span class="n">w</span><span class="p">):</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">weights</span><span class="p">)</span>
        <span class="n">api_mean</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">prec</span><span class="p">[(</span><span class="n">i</span><span class="o">-</span><span class="n">w</span><span class="p">):</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">weights_sum</span>
        <span class="n">napi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">api</span> <span class="o">/</span> <span class="n">api_mean</span>
    <span class="k">return</span> <span class="n">napi</span></div>


<div class="viewcode-block" id="calc_rmse"><a class="viewcode-back" href="../../../reference/api/tools.html#roger.tools.evaluation.calc_rmse">[docs]</a><span class="k">def</span> <span class="nf">calc_rmse</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">sim</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Root mean square error (RMSE)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obs : (N,)array_like</span>
<span class="sd">        observed time series</span>

<span class="sd">    sim : (N,)array_like</span>
<span class="sd">        simulated time series</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    eff : float</span>
<span class="sd">        Root mean square error (RMSE)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">eff</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">onp</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">sim</span> <span class="o">-</span> <span class="n">obs</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">eff</span></div>


<div class="viewcode-block" id="calc_mae"><a class="viewcode-back" href="../../../reference/api/tools.html#roger.tools.evaluation.calc_mae">[docs]</a><span class="k">def</span> <span class="nf">calc_mae</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">sim</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Mean absolute error (MAE)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obs : (N,)array_like</span>
<span class="sd">        observed time series</span>

<span class="sd">    sim : (N,)array_like</span>
<span class="sd">        simulated time series</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    eff : float</span>
<span class="sd">        Mean absolute error (MAE)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">abs_err</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sim</span> <span class="o">-</span> <span class="n">obs</span><span class="p">)</span>
    <span class="n">eff</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">abs_err</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">eff</span></div>


<div class="viewcode-block" id="calc_mre"><a class="viewcode-back" href="../../../reference/api/tools.html#roger.tools.evaluation.calc_mre">[docs]</a><span class="k">def</span> <span class="nf">calc_mre</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">sim</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Mean relative error (MRE)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obs : (N,)array_like</span>
<span class="sd">        observed time series</span>

<span class="sd">    sim : (N,)array_like</span>
<span class="sd">        simulated time series</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    eff : float</span>
<span class="sd">        Mean relative error (MRE)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rel_err</span> <span class="o">=</span> <span class="p">(</span><span class="n">sim</span> <span class="o">-</span> <span class="n">obs</span><span class="p">)</span> <span class="o">/</span> <span class="n">obs</span>
    <span class="n">eff</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rel_err</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">eff</span></div>


<div class="viewcode-block" id="calc_mare"><a class="viewcode-back" href="../../../reference/api/tools.html#roger.tools.evaluation.calc_mare">[docs]</a><span class="k">def</span> <span class="nf">calc_mare</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">sim</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Mean absolute relative error (MARE)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obs : (N,)array_like</span>
<span class="sd">        observed time series</span>

<span class="sd">    sim : (N,)array_like</span>
<span class="sd">        simulated time series</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    eff : float</span>
<span class="sd">        Mean absolute relative error (MARE)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">abs_err</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sim</span> <span class="o">-</span> <span class="n">obs</span><span class="p">)</span>
    <span class="n">rel_err</span> <span class="o">=</span> <span class="n">abs_err</span><span class="o">/</span><span class="n">obs</span>
    <span class="n">eff</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rel_err</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">eff</span></div>


<div class="viewcode-block" id="calc_ve"><a class="viewcode-back" href="../../../reference/api/tools.html#roger.tools.evaluation.calc_ve">[docs]</a><span class="k">def</span> <span class="nf">calc_ve</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">sim</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Volumetric efficiency (VE)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obs : (N,)array_like</span>
<span class="sd">        observed time series</span>

<span class="sd">    sim : (N,)array_like</span>
<span class="sd">        simulated time series</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    eff : float</span>
<span class="sd">        Volumetric efficiency (VE)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">abs_err</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sim</span> <span class="o">-</span> <span class="n">obs</span><span class="p">)</span>
    <span class="n">sum_abs_err</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">abs_err</span><span class="p">)</span>
    <span class="n">sum_obs</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
    <span class="n">eff</span> <span class="o">=</span> <span class="n">sum_abs_err</span><span class="o">/</span><span class="n">sum_obs</span>

    <span class="k">return</span> <span class="n">eff</span></div>


<div class="viewcode-block" id="calc_rbs"><a class="viewcode-back" href="../../../reference/api/tools.html#roger.tools.evaluation.calc_rbs">[docs]</a><span class="k">def</span> <span class="nf">calc_rbs</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">sim</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Relative bias of sums (RBS)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obs : (N,)array_like</span>
<span class="sd">        observed time series</span>

<span class="sd">    sim : (N,)array_like</span>
<span class="sd">        simulated time series</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    eff : float</span>
<span class="sd">        relative bias of sums (RBS)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">eff</span> <span class="o">=</span> <span class="p">(</span><span class="n">onp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span> <span class="o">-</span> <span class="n">onp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">obs</span><span class="p">))</span> <span class="o">/</span> <span class="n">onp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">eff</span></div>


<div class="viewcode-block" id="calc_temp_cor"><a class="viewcode-back" href="../../../reference/api/tools.html#roger.tools.evaluation.calc_temp_cor">[docs]</a><span class="k">def</span> <span class="nf">calc_temp_cor</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">sim</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="s2">&quot;pearson&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate temporal correlation between observed and simulated</span>
<span class="sd">    time series.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obs : (N,)array_like</span>
<span class="sd">        Observed time series as 1-D array</span>

<span class="sd">    sim : (N,)array_like</span>
<span class="sd">        Simulated time series</span>

<span class="sd">    r : str, optional</span>
<span class="sd">        Either Spearman correlation coefficient (&#39;spearman&#39;) or Pearson</span>
<span class="sd">        correlation coefficient (&#39;pearson&#39;) can be used to describe the</span>
<span class="sd">        temporalcorrelation. The default is to calculate the Pearson</span>
<span class="sd">        correlation.</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    temp_cor : float</span>
<span class="sd">        correlation between observed and simulated time series</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Provide arrays with equal length</span>

<span class="sd">    &gt;&gt;&gt; from de import de</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; obs = onp.array([1.5, 1, 0.8, 0.85, 1.5, 2])</span>
<span class="sd">    &gt;&gt;&gt; sim = onp.array([1.6, 1.3, 1, 0.8, 1.2, 2.5])</span>
<span class="sd">    &gt;&gt;&gt; de.calc_temp_cor(obs, sim)</span>
<span class="sd">    0.8940281850583509</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sim</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;Arrays are not of equal length!&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="s2">&quot;spearman&quot;</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">spearmanr</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">sim</span><span class="p">)</span>
        <span class="n">temp_cor</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">onp</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">temp_cor</span><span class="p">):</span>
            <span class="n">temp_cor</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">elif</span> <span class="n">r</span> <span class="o">==</span> <span class="s2">&quot;pearson&quot;</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">sim</span><span class="p">)</span>
        <span class="n">temp_cor</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">onp</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">temp_cor</span><span class="p">):</span>
            <span class="n">temp_cor</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="n">temp_cor</span></div>


<div class="viewcode-block" id="calc_kge_beta"><a class="viewcode-back" href="../../../reference/api/tools.html#roger.tools.evaluation.calc_kge_beta">[docs]</a><span class="k">def</span> <span class="nf">calc_kge_beta</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">sim</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the beta term of Kling-Gupta-Efficiency (KGE).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obs : (N,)array_like</span>
<span class="sd">        Observed time series as 1-D array</span>

<span class="sd">    sim : (N,)array_like</span>
<span class="sd">        Simulated time series as 1-D array</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    kge_beta : float</span>
<span class="sd">        alpha value</span>

<span class="sd">    Notes</span>
<span class="sd">    ----------</span>
<span class="sd">    .. math::</span>

<span class="sd">        \beta = \frac{\mu_{sim}}{\mu_{obs}}</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Provide arrays with equal length</span>

<span class="sd">    &gt;&gt;&gt; from de import de</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; obs = onp.array([1.5, 1, 0.8, 0.85, 1.5, 2])</span>
<span class="sd">    &gt;&gt;&gt; sim = onp.array([1.6, 1.3, 1, 0.8, 1.2, 2.5])</span>
<span class="sd">    &gt;&gt;&gt; de.calc_kge_beta(obs, sim)</span>
<span class="sd">    1.0980392156862746</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    Gupta, H. V., Kling, H., Yilmaz, K. K., and Martinez, G. F.: Decomposition</span>
<span class="sd">    of the mean squared error and NSE performance criteria: Implications for</span>
<span class="sd">    improving hydrological modelling, Journal of Hydrology, 377, 80-91,</span>
<span class="sd">    10.1016/j.jhydrol.2009.08.003, 2009.</span>

<span class="sd">    Kling, H., Fuchs, M., and Paulin, M.: Runoff conditions in the upper</span>
<span class="sd">    Danube basin under an ensemble of climate change scenarios, Journal of</span>
<span class="sd">    Hydrology, 424-425, 264-277, 10.1016/j.jhydrol.2012.01.011, 2012.</span>

<span class="sd">    Pool, S., Vis, M., and Seibert, J.: Evaluating model performance: towards a</span>
<span class="sd">    non-parametric variant of the Kling-Gupta efficiency, Hydrological Sciences</span>
<span class="sd">    Journal, 63, 1941-1953, 10.1080/02626667.2018.1552002, 2018.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sim</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;Arrays are not of equal length!&quot;</span><span class="p">)</span>

    <span class="c1"># calculate alpha term</span>
    <span class="n">obs_mean</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
    <span class="n">sim_mean</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span>
    <span class="n">kge_beta</span> <span class="o">=</span> <span class="n">sim_mean</span> <span class="o">/</span> <span class="n">obs_mean</span>

    <span class="k">return</span> <span class="n">kge_beta</span></div>


<div class="viewcode-block" id="calc_kge_alpha"><a class="viewcode-back" href="../../../reference/api/tools.html#roger.tools.evaluation.calc_kge_alpha">[docs]</a><span class="k">def</span> <span class="nf">calc_kge_alpha</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">sim</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the alpha term of the Kling-Gupta-Efficiency (KGE).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obs : (N,)array_like</span>
<span class="sd">        Observed time series as 1-D array</span>

<span class="sd">    sim : (N,)array_like</span>
<span class="sd">        Simulated time series</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    kge_alpha : float</span>
<span class="sd">        alpha value</span>

<span class="sd">    Notes</span>
<span class="sd">    ----------</span>
<span class="sd">    .. math::</span>

<span class="sd">        \alpha = \frac{\sigma_{sim}}{\sigma_{obs}}</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Provide arrays with equal length</span>

<span class="sd">    &gt;&gt;&gt; from de import de</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; obs = onp.array([1.5, 1, 0.8, 0.85, 1.5, 2])</span>
<span class="sd">    &gt;&gt;&gt; sim = onp.array([1.6, 1.3, 1, 0.8, 1.2, 2.5])</span>
<span class="sd">    &gt;&gt;&gt; kge.calc_kge_alpha(obs, sim)</span>
<span class="sd">    1.2812057455166919</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    Gupta, H. V., Kling, H., Yilmaz, K. K., and Martinez, G. F.: Decomposition</span>
<span class="sd">    of the mean squared error and NSE performance criteria: Implications for</span>
<span class="sd">    improving hydrological modelling, Journal of Hydrology, 377, 80-91,</span>
<span class="sd">    10.1016/j.jhydrol.2009.08.003, 2009.</span>

<span class="sd">    Kling, H., Fuchs, M., and Paulin, M.: Runoff conditions in the upper</span>
<span class="sd">    Danube basin under an ensemble of climate change scenarios, Journal of</span>
<span class="sd">    Hydrology, 424-425, 264-277, 10.1016/j.jhydrol.2012.01.011, 2012.</span>

<span class="sd">    Pool, S., Vis, M., and Seibert, J.: Evaluating model performance: towards a</span>
<span class="sd">    non-parametric variant of the Kling-Gupta efficiency, Hydrological Sciences</span>
<span class="sd">    Journal, 63, 1941-1953, 10.1080/02626667.2018.1552002, 2018.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sim</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;Arrays are not of equal length!&quot;</span><span class="p">)</span>

    <span class="n">obs_std</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
    <span class="n">sim_std</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span>
    <span class="n">kge_alpha</span> <span class="o">=</span> <span class="n">sim_std</span> <span class="o">/</span> <span class="n">obs_std</span>

    <span class="k">return</span> <span class="n">kge_alpha</span></div>


<div class="viewcode-block" id="calc_kge_gamma"><a class="viewcode-back" href="../../../reference/api/tools.html#roger.tools.evaluation.calc_kge_gamma">[docs]</a><span class="k">def</span> <span class="nf">calc_kge_gamma</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">sim</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the gamma term of Kling-Gupta-Efficiency (KGE).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obs : (N,)array_like</span>
<span class="sd">        Observed time series as 1-D array</span>

<span class="sd">    sim : (N,)array_like</span>
<span class="sd">        Simulated time series as 1-D array</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    kge_gamma : float</span>
<span class="sd">        gamma value</span>

<span class="sd">    Notes</span>
<span class="sd">    ----------</span>
<span class="sd">    .. math::</span>

<span class="sd">        \gamma = \frac{CV_{sim}}{CV_{obs}}</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Provide arrays with equal length</span>

<span class="sd">    &gt;&gt;&gt; from de import de</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; obs = onp.array([1.5, 1, 0.8, 0.85, 1.5, 2])</span>
<span class="sd">    &gt;&gt;&gt; sim = onp.array([1.6, 1.3, 1, 0.8, 1.2, 2.5])</span>
<span class="sd">    &gt;&gt;&gt; kge.calc_kge_gamma(obs, sim)</span>
<span class="sd">    1.166812375381273</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    Gupta, H. V., Kling, H., Yilmaz, K. K., and Martinez, G. F.: Decomposition</span>
<span class="sd">    of the mean squared error and NSE performance criteria: Implications for</span>
<span class="sd">    improving hydrological modelling, Journal of Hydrology, 377, 80-91,</span>
<span class="sd">    10.1016/j.jhydrol.2009.08.003, 2009.</span>

<span class="sd">    Kling, H., Fuchs, M., and Paulin, M.: Runoff conditions in the upper</span>
<span class="sd">    Danube basin under an ensemble of climate change scenarios, Journal of</span>
<span class="sd">    Hydrology, 424-425, 264-277, 10.1016/j.jhydrol.2012.01.011, 2012.</span>

<span class="sd">    Pool, S., Vis, M., and Seibert, J.: Evaluating model performance: towards a</span>
<span class="sd">    non-parametric variant of the Kling-Gupta efficiency, Hydrological Sciences</span>
<span class="sd">    Journal, 63, 1941-1953, 10.1080/02626667.2018.1552002, 2018.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sim</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;Arrays are not of equal length!&quot;</span><span class="p">)</span>

    <span class="n">obs_mean</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
    <span class="n">sim_mean</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span>
    <span class="n">obs_std</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
    <span class="n">sim_std</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span>
    <span class="n">obs_cv</span> <span class="o">=</span> <span class="n">obs_std</span> <span class="o">/</span> <span class="n">obs_mean</span>
    <span class="n">sim_cv</span> <span class="o">=</span> <span class="n">sim_std</span> <span class="o">/</span> <span class="n">sim_mean</span>
    <span class="n">kge_gamma</span> <span class="o">=</span> <span class="n">sim_cv</span> <span class="o">/</span> <span class="n">obs_cv</span>

    <span class="k">return</span> <span class="n">kge_gamma</span></div>


<div class="viewcode-block" id="calc_kge"><a class="viewcode-back" href="../../../reference/api/tools.html#roger.tools.evaluation.calc_kge">[docs]</a><span class="k">def</span> <span class="nf">calc_kge</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">sim</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="s2">&quot;pearson&quot;</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="s2">&quot;std&quot;</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate Kling-Gupta-Efficiency (KGE).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obs : (N,)array_like</span>
<span class="sd">        Observed time series as 1-D array</span>

<span class="sd">    sim : (N,)array_like</span>
<span class="sd">        Simulated time series as 1-D array</span>

<span class="sd">    r : str, optional</span>
<span class="sd">        Either Spearman correlation coefficient (&#39;spearman&#39;; Pool et al. 2018)</span>
<span class="sd">        or Pearson correlation coefficient (&#39;pearson&#39;; Gupta et al. 2009) can</span>
<span class="sd">        be used to describe the temporal correlation. The default is to</span>
<span class="sd">        calculate the Pearson correlation.</span>

<span class="sd">    var : str, optional</span>
<span class="sd">        Either coefficient of variation (&#39;cv&#39;; Kling et al. 2012) or standard</span>
<span class="sd">        deviation (&#39;std&#39;; Gupta et al. 2009, Pool et al. 2018) to describe the</span>
<span class="sd">        gamma term. The default is to calculate the standard deviation.</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    eff : float</span>
<span class="sd">        Kling-Gupta-Efficiency</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Provide arrays with equal length</span>

<span class="sd">    &gt;&gt;&gt; from de import de</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; obs = onp.array([1.5, 1, 0.8, 0.85, 1.5, 2])</span>
<span class="sd">    &gt;&gt;&gt; sim = onp.array([1.6, 1.3, 1, 0.8, 1.2, 2.5])</span>
<span class="sd">    &gt;&gt;&gt; kge.calc_kge(obs, sim)</span>
<span class="sd">    0.683901305466148</span>

<span class="sd">    Notes</span>
<span class="sd">    ----------</span>
<span class="sd">    .. math::</span>

<span class="sd">        KGE = 1 - \sqrt{(\beta - 1)^2 + (\alpha - 1)^2 + (r - 1)^2}</span>

<span class="sd">        KGE = 1 - \sqrt{(\frac{\mu_{sim}}{\mu_{obs}} - 1)^2 + (\frac{\sigma_{sim}}{\sigma_{obs}} - 1)^2 + (r - 1)^2}</span>

<span class="sd">        KGE = 1 - \sqrt{(\beta - 1)^2 + (\gamma - 1)^2 + (r - 1)^2}</span>

<span class="sd">        KGE = 1 - \sqrt{(\frac{\mu_{sim}}{\mu_{obs}} - 1)^2 + (\frac{CV_{sim}}{CV_{obs}} - 1)^2 + (r - 1)^2}</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    Gupta, H. V., Kling, H., Yilmaz, K. K., and Martinez, G. F.: Decomposition</span>
<span class="sd">    of the mean squared error and NSE performance criteria: Implications for</span>
<span class="sd">    improving hydrological modelling, Journal of Hydrology, 377, 80-91,</span>
<span class="sd">    10.1016/j.jhydrol.2009.08.003, 2009.</span>

<span class="sd">    Kling, H., Fuchs, M., and Paulin, M.: Runoff conditions in the upper</span>
<span class="sd">    Danube basin under an ensemble of climate change scenarios, Journal of</span>
<span class="sd">    Hydrology, 424-425, 264-277, 10.1016/j.jhydrol.2012.01.011, 2012.</span>

<span class="sd">    Pool, S., Vis, M., and Seibert, J.: Evaluating model performance: towards a</span>
<span class="sd">    non-parametric variant of the Kling-Gupta efficiency, Hydrological Sciences</span>
<span class="sd">    Journal, 63, 1941-1953, 10.1080/02626667.2018.1552002, 2018.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sim</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;Arrays are not of equal length!&quot;</span><span class="p">)</span>
    <span class="c1"># calculate alpha term</span>
    <span class="n">obs_mean</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
    <span class="n">sim_mean</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span>
    <span class="n">kge_beta</span> <span class="o">=</span> <span class="n">sim_mean</span> <span class="o">/</span> <span class="n">obs_mean</span>

    <span class="c1"># calculate KGE with gamma term</span>
    <span class="k">if</span> <span class="n">var</span> <span class="o">==</span> <span class="s2">&quot;cv&quot;</span><span class="p">:</span>
        <span class="n">kge_gamma</span> <span class="o">=</span> <span class="n">calc_kge_gamma</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">sim</span><span class="p">)</span>
        <span class="n">temp_cor</span> <span class="o">=</span> <span class="n">calc_temp_cor</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">sim</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">)</span>

        <span class="n">eff</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">onp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
            <span class="p">(</span><span class="n">kge_beta</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">kge_gamma</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">temp_cor</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="p">)</span>

    <span class="c1"># calculate KGE with beta term</span>
    <span class="k">elif</span> <span class="n">var</span> <span class="o">==</span> <span class="s2">&quot;std&quot;</span><span class="p">:</span>
        <span class="n">kge_alpha</span> <span class="o">=</span> <span class="n">calc_kge_alpha</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">sim</span><span class="p">)</span>
        <span class="n">temp_cor</span> <span class="o">=</span> <span class="n">calc_temp_cor</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">sim</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">)</span>

        <span class="n">eff</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">onp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
            <span class="p">(</span><span class="n">kge_beta</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">kge_alpha</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">temp_cor</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">eff</span></div>


<div class="viewcode-block" id="calc_nse"><a class="viewcode-back" href="../../../reference/api/tools.html#roger.tools.evaluation.calc_nse">[docs]</a><span class="k">def</span> <span class="nf">calc_nse</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">sim</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate Nash-Sutcliffe-Efficiency (NSE).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obs : (N,)array_like</span>
<span class="sd">        Observed time series as 1-D array</span>

<span class="sd">    sim : (N,)array_like</span>
<span class="sd">        Simulated time series as 1-D array</span>

<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    eff : float</span>
<span class="sd">        Nash-Sutcliffe-Efficiency</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Provide arrays with equal length</span>

<span class="sd">    &gt;&gt;&gt; from de import de</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; obs = onp.array([1.5, 1, 0.8, 0.85, 1.5, 2])</span>
<span class="sd">    &gt;&gt;&gt; sim = onp.array([1.6, 1.3, 1, 0.8, 1.2, 2.5])</span>
<span class="sd">    &gt;&gt;&gt; nse.calc_nse(obs, sim)</span>
<span class="sd">    0.5648252536640361</span>

<span class="sd">    Notes</span>
<span class="sd">    ----------</span>
<span class="sd">    .. math::</span>

<span class="sd">        NSE = 1 - \frac{\sum_{t=1}^{t=T} (Q_{sim}(t) - Q_{obs}(t))^2}{\sum_{t=1}^{t=T} (Q_{obs}(t) - \overline{Q_{obs}})^2}</span>


<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    Nash, J. E., and Sutcliffe, J. V.: River flow forecasting through</span>
<span class="sd">    conceptual models part I - A discussion of principles, Journal of</span>
<span class="sd">    Hydrology, 10, 282-290, 10.1016/0022-1694(70)90255-6, 1970.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sim</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;Arrays are not of equal length!&quot;</span><span class="p">)</span>
    <span class="n">sim_obs_diff</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">sim</span> <span class="o">-</span> <span class="n">obs</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">obs_mean</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
    <span class="n">obs_diff_mean</span> <span class="o">=</span> <span class="n">onp</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">obs</span> <span class="o">-</span> <span class="n">obs_mean</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">eff</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">sim_obs_diff</span> <span class="o">/</span> <span class="n">obs_diff_mean</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">eff</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2022, The RoGeR Team, University of Freiburg.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>